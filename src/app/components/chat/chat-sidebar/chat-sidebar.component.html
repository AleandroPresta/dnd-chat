<div class="flex h-full flex-col bg-slate-800">
    <!-- App Logo -->
    <div class="px-4 py-5">
        <h1 class="text-xl font-bold text-white">D&D Chat</h1>
    </div>
    <!-- Create Room Button -->
    <div class="px-4 pb-2">
        <button
            (click)="toggleCreateRoomForm()"
            class="w-full rounded-lg bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
            Create New Room
        </button>
    </div>
    <!-- Create Room Modal Dialog -->
    <div
        *ngIf="showCreateRoomForm"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
    >
        <div class="animate-fade-in-up relative mx-4 w-full max-w-md sm:mx-0">
            <div
                class="rounded-lg bg-slate-700 p-6 shadow-2xl ring-1 ring-black/10"
            >
                <div class="mb-4 flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-white">
                        Create a New Room
                    </h2>
                    <button
                        (click)="toggleCreateRoomForm()"
                        class="text-slate-300 hover:text-white focus:outline-none"
                        aria-label="Close modal"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"
                            />
                        </svg>
                    </button>
                </div>
                <form [formGroup]="roomForm" (ngSubmit)="createRoom()">
                    <input
                        type="text"
                        formControlName="name"
                        placeholder="Room name"
                        class="mb-2 w-full rounded-lg bg-slate-600 px-4 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                    <input
                        type="text"
                        formControlName="description"
                        placeholder="Description (optional)"
                        class="mb-2 w-full rounded-lg bg-slate-600 px-4 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                    <div class="mt-4 flex justify-end space-x-2">
                        <button
                            type="button"
                            (click)="toggleCreateRoomForm()"
                            class="rounded-lg bg-gray-500 px-3 py-1 text-xs text-white hover:bg-gray-600"
                        >
                            Cancel
                        </button>
                        <button
                            type="submit"
                            [disabled]="roomForm.invalid"
                            class="rounded-lg bg-indigo-600 px-3 py-1 text-xs text-white hover:bg-indigo-700 disabled:bg-indigo-400"
                        >
                            Create
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Search Bar -->
    <div class="px-4 pb-4">
        <div class="relative">
            <input
                type="text"
                placeholder="Search rooms..."
                class="w-full rounded-lg bg-slate-700 px-4 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"
            />
        </div>
    </div>
    <!-- Chat Rooms List -->
    <div class="flex items-center justify-between px-4 pb-3">
        <h3
            class="text-xs font-semibold uppercase tracking-wider text-slate-400"
        >
            Chat Rooms
        </h3>
        <div *ngIf="loading.rooms" class="text-xs text-slate-400">
            Loading...
        </div>
    </div>
    <!-- Room List with Scrolling -->
    <div class="message-container flex-1 overflow-y-auto px-2">
        <div
            *ngFor="let room of rooms"
            [class.bg-slate-700]="currentRoom?.id === room.id"
            (click)="joinRoom(room.id)"
            class="mb-1 flex cursor-pointer flex-col rounded-lg p-2 transition-colors hover:bg-slate-700/70"
        >
            <div class="font-medium text-white">{{ room.name }}</div>
            <div class="truncate text-xs text-slate-400">
                {{ room.description || 'No description' }}
            </div>
        </div>
        <div
            *ngIf="rooms.length === 0 && !loading.rooms"
            class="py-4 text-center"
        >
            <p class="text-sm text-slate-400">No rooms available</p>
            <p class="mt-1 text-xs text-slate-500">
                Create a new room to get started
            </p>
        </div>
    </div>
    <!-- User Profile Section -->
    <div class="border-t border-slate-700 p-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div
                    class="flex h-8 w-8 items-center justify-center rounded-full bg-indigo-500 text-white"
                >
                    {{
                        authService.currentUser?.username?.charAt(0) ||
                            authService.currentUser?.email?.charAt(0) ||
                            '?'
                    }}
                </div>
                <span class="ml-2 truncate font-medium text-white">
                    {{
                        authService.currentUser?.username ||
                            authService.currentUser?.email ||
                            'Anonymous'
                    }}
                </span>
            </div>
            <button
                (click)="onLogout()"
                class="text-slate-400 hover:text-white"
                title="Logout"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                >
                    <path
                        fill-rule="evenodd"
                        d="M3 3a1 1 0 00-1 1v12a1 1 0 001 1h12a1 1 0 001-1V7.414l-5-5H3zm7 2a1 1 0 011 1v3.586l3.707-3.707a1 1 0 011.414 1.414l-5.414 5.414a1 1 0 01-1.414 0L5.586 9a1 1 0 011.414-1.414L10 11.586V6a1 1 0 011-1z"
                        clip-rule="evenodd"
                    />
                </svg>
            </button>
        </div>
    </div>
</div>
